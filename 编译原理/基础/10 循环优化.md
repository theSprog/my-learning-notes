### 循环展开

循环展开牺牲了程序尺寸，但是可以加快程序执行速度。

#### 优点

- 减少循环分支指令的判断次数

  > 例如 for 以 1 为步长循环十次，每一次都要判断当前次数是否小于 10。但如果以 5 为步长，只需要判断 10 / 2 次即可

- 获得更多的指令级并行

- 增加寄存器重用

![image-20221207141801599](https://src-1259777572.cos.ap-chengdu.myqcloud.com/image-20221207141801599.png)

#### 循环完全展开

如果迭代次数是编译期已知的，可以按照迭代次数将循环完全重写为若干指令的重复。并不是循环展开程度越多程序性能越高，如果撑爆了指令缓存区造成缓存 miss 有可能反而不如不优化时候的性能



#### 尾循环

当迭代次数不能被循环展开幅度整除时，需要加入尾循环处理。如果循环是 512 次，展开幅度为 3。则会剩余 2 次需要额外进行处理

<img src="https://src-1259777572.cos.ap-chengdu.myqcloud.com/image-20221207142557297.png" alt="image-20221207142557297" style="zoom:67%;" />

### 循环合并（Loop Fusion）

循环合并是将具有相同迭代空间的两个循环合成一个循环的过程，属于语句层次的循环变换。

<img src="https://src-1259777572.cos.ap-chengdu.myqcloud.com/image-20221207143003536.png" alt="image-20221207143003536" style="zoom:67%;" />

#### 优点

- 减少循环迭代开销

  > 对于上面的循环未合并之前需要进行两次 for 迭代

- 增强寄存器重用

- 增加编译器优化范围