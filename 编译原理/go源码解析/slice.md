### slice结构

slice结构体有三个部分：一个 data 指针指向数据存储地址，一个 len 表示切片长度，一个 cap 表示切片容量。data指针指向某一个底层数组的某一个地址处。可以通过 append 向切片添加元素，增加 len 值。可以通过移动数据指针来完成删除元素的操作

<img src="https://bucket01-1259777572.cos.ap-chengdu.myqcloud.com/img/202204121335348.png" style="zoom: 50%;" />

```go
var a []int;	// 此时 data = nil, len = 0, cap = 0

// make 只能用于初始化 slice, map 和 channel
var b []int = make([]int, 2, 5)	// data 指向make开辟的底层数组（长度为 5，元素初始化为 0）的起始地址处, len = 2, cap = 5

b = b[1:] // 删除开头1个元素
b = b[:len(a)-1] // 删除尾部1个元素
```



slice可以引用已经生成的数组，data 指针指向该数组的某一个元素起始处，而 cap 由该元素到结尾处共有多少个元素指定

<img src="https://bucket01-1259777572.cos.ap-chengdu.myqcloud.com/img/202204121352652.png" style="zoom:50%;" />



### slice扩容规则

1. 预估扩容后的容量

   - 如果旧有容量哪怕翻倍仍然无法容纳新到来的元素，那新容量直接设置为扩容后容量。例如旧有容量为 2，到来 3 个元素，旧有容量翻倍也无法容纳新到来的元素，那么新容量设置为 5
   - 如果旧有容量翻倍可以容纳新到来的元素，那么再次讨论：
     - 若旧有容量小于 1024，则容量直接翻倍
     - 若旧有容量大于等于 1024，则**循环不断扩容** 1.25 倍，直到能够容纳到来的元素为止

2. 得到实际内存

   - 将预估容量乘以元素大小，得到需求的内存
   - 向内存管理模块申请该内存，一般内存管理模块为了分配的方便，会返回更多一点的内存。例如申请 24 字节，则返回 32 字节；申请 50 字节，返回 64 字节

3. 用得到的内存大小除以元素大小，得到实际容量

   