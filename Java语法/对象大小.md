### 程序计算对象大小

maven 引入依赖 `lucene-core`

```xml
<dependency>
    <groupId>org.apache.lucene</groupId>
    <artifactId>lucene-core</artifactId>
    <!-- 4.0.0 有 humanSizeOf, 他返回与其引用树上所有对象的总大小 -->
    <version>4.0.0</version>
</dependency>
```

测试 `lucene` 中的 `RamUsageEstimator.shallowSizeOf()`，返回值是占用多少个字节

```java
public class Test {
    public static void main(String[] args) {
        Integer integer = new Integer(10);
        long c = RamUsageEstimator.shallowSizeOf(integer);  // 16
        String s = RamUsageEstimator.humanSizeOf(integer);  // 16
    }
}
```



### 对象地址空间

对象由 **头** 和 **内容** 组成

- 头
  - 地址 4 个字节
  - 标记 8 个字节，包括
    - 锁：如果该对象作为一把锁，则锁是否被持有
    - hashcode：该对象的哈希值，避免重复计算
    - age：对象每熬过一次GC，年龄就要+1，待对象到达设置的阈值（默认为15岁）就会被移移动到老年代
  - 如果是数组对象，这里有额外的4个字节，记录长度，这也是为什么数组最大的长度是一个 int 的最大值。如果不是数组则没有这部分空间
- 内容
  - 引用类型只是记录一个地址，占 4 字节
  - 数组也是一个地址，4 字节



### **8字节对齐**

Java对象采用的是 8 字节对齐。对象大小必须是8的倍数，不足需要补齐。比如，计算一个对象只需要20字节，那么实际占用24字节



